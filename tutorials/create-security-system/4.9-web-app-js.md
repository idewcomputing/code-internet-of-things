# 4.9 Web App JS

Next, you'll add JavaScript code to allow your web app to interact with your Photon device through Particle Cloud. Remember that the web app will perform these tasks:

1. The web app will display whether the security device is currently armed or disarmed. The web app will do this by getting the value of the `deviceMode` variable in your Photon device app.
2. The web app will display a toggle switch that can be clicked to remotely toggle the security device between armed and disarmed mode. The web app will do this by calling the `toggleMode()` function in your Photon device app.
3. The web app will display a notification if the security device detects motion when the device is armed. The web app will also display the date and time of the most recent motion notification. The web app will do this by receiving event notifications sent from your Photon device app.

## Add Starter JS {#add-starter-html}

[â€‹Copy this starter JS for your web app](https://docs.idew.org/code-internet-of-things/references/web-app#js), and paste it into a **blank** JS file named `code.js`.

{% hint style="danger" %}
**IMPORTANT:** You must modify this JS code to [insert your actual Photon device ID and access token](https://docs.idew.org/code-internet-of-things/references/particle-cloud/web-app-prep-steps#device-id-and-access-token). Otherwise, your web app will **not** work properly.
{% endhint %}

## Add Custom JS {#add-custom-html}

Copy this JS, and add it **after** your modified starter JS:

```javascript
var alertSound = new Audio("notification.wav");

window.setInterval(checkMode, 500);

function checkMode() {
    particle.getVariable({ deviceId: myDevice, name: "deviceMode", auth: myToken }).then(function(data) {
        // add code to do something with value returned as: data.body.result
        if (data.body.result == "armed") {
            $("#system-mode").html("ARMED");
            $("input[name=toggle]").prop("checked", true);
        }
        else if (data.body.result == "disarmed") {
            $("#system-mode").html("DISARMED");
            $("input[name=toggle]").prop("checked", false);
        }
    }, function(err) {
            console.log("An error occurred: ", err);
    });
}

function toggleMode() {
    particle.callFunction({ deviceId: myDevice, name: "toggleMode", argument: "data", auth: myToken });
}

particle.getEventStream({ deviceId: myDevice, name: "motion", auth: myToken }).then(function(stream) {
  stream.on('event', function(feed) {
    // add code to do something when event notification received
    // any text data received is stored as: feed.data
    alertSound.play();
    var d = new Date();
    var dateTime = d.toLocaleString();
    $("#event-time").html(dateTime);
    $("#motion-alert").show().delay(1500).fadeOut();
  });
});
```

A variable named `alertSound` is declared that stores an audio file named `"notification.wav"`. [Download a copy of this audio file](https://drive.google.com/open?id=1MYgo-SFuQLOSA2Z0tW8eVqg_5P6EYtc1), and place it in the **same folder** as your web app files.

The `window.setInterval()` method will automatically call a function named `checkMode()` every `500` ms \(0.5 seconds\).

The function named `checkMode()` contains a call to the `particle.getVariable()` method that will get the current value of the `"deviceMode"` variable in your Photon app.

Inside the `particle.getVariable()` method are JS and jQuery code statements \(lines 8-15 above\) that were added to perform actions based on the value returned for the Photon variable.

An if-else statement is used to determine whether `data.body.result` has a value equivalent to `"armed"` or `"disarmed"`. Then jQuery statements \(which start with `$`\) are used to dynamically change the information displayed in the first "card" by targeting specific [id selectors](https://www.w3schools.com/jquery/jquery_selectors.asp):

* `$("#system-mode")` targets the HTML element with `id="system-mode"`. The jQuery statements change this element's HTML to list either `ARMED` or `DISARMED`.
* `$("input [name=toggle])` targets the `<input>` element with `name="toggle"`. The jQuery statements change its `"checked"` property to either `true` \(checked\) or `false` \(unchecked\), which changes the toggle switch slider position.

The function named `toggleMode()` contains a call to the `particle.callFunction()` method that will call the `"toggleMode"` function in your Photon app to remotely switch your device's mode between "armed" and "disarmed".

The `particle.getEventStream()` method is used to start listening for `"motion"` event notifications sent from your Photon app. Inside the `particle.getEventStream()` method are JS and jQuery code statements \(lines 29-33 above\) that will:

* play `alertSound`
* get the current date and time and store it in a variable named `dateTime`
* display the value of `dateTime` in the HTML element with `id="event-time"`
* show the HTML element with `id="motion-alert"`, wait for `1500` ms \(1.5 seconds\), and then fade out the element until it is hidden again

## Test Web App

Be sure your Photon device is connected to Wi-Fi and Particle Cloud.

Refresh your web app, and test it with your Photon device to make sure they interact correctly:

* Verify that your web app displays the current mode \("armed" or "disarmed"\) of your Smart Security device. Use the push button connected to your Photon device to change the device mode.  When the LED is turned on, the device is in "armed" mode. When the LED is turned off, the device is "disarmed." Verify that your web app updates automatically to show the correct device mode.
* Verify that your web app can remotely change the device mode. Click the toggle switch in your web app, and verify that your Photon device automatically toggles modes \(by checking the LED\).
* While your Smart Security device is in "armed" mode, trigger a motion alert. Verify that your web app displays a motion notification pop-up \(which will fade out after 1.5 seconds\). Verify the web app displays the correct date and time for the last motion event notification.

